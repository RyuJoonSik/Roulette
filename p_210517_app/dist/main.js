(()=>{"use strict";const t={isString(t){let e=!0;return"string"!=typeof t&&(e=!1,console.log("is not String.")),e},isNumber(t){let e=!0;return"number"!=typeof t&&(e=!1,console.log("is not Number.")),e},isBoolean(t){let e=!0;return"boolean"!=typeof t&&(e=!1,console.log("is not Boolean.")),e},isObject(t){let e=!0;return"object"!=typeof t&&(e=!1,console.log("is not Object.")),e},isArray(t){let e=!0;return Array.isArray(t)||(e=!1,console.log("is not Array.")),e},isNull(t){let e=!0;return null!==t&&(e=!1,console.log("is not Null.")),e},isUndefined(t){let e=!0;return void 0!==t&&(e=!1,console.log("is not Undefined.")),e},isElementNode(t){let e=!0;return 1!==t.nodeType&&(e=!1,console.log("is not Element node.")),e}},e={setHTML(){const t=document.createElement("section");t.className="wrapper",t.innerHTML='\n      <ul id="districtList" class="main-district">\n      </ul>\n      <article id="roulette" class="roulette">\n        <canvas id="canvas" class="roulette--canvas">대체 텍스트 입니다.</canvas>\n        <button  id="start" class="roulette--button">\n          <span>START</span>\n        </button>\n      </article>\n      <ul id="recordList" class="record">\n      </ul>\n    ',document.body.prepend(t)},createEl(e,i=""){if(!t.isString(e)||!t.isString(i))return void console.log("WRONG TYPE");let s;switch(e){case"LI":return s=document.createElement("li"),s.className="main-district--list",s;case"STRONG":return s=document.createElement("strong"),s.className="main-district--name",s.innerText=i,s;case"EM":return s=document.createElement("em"),s.className="main-district--number",s;case"UL":return s=document.createElement("ul"),s.className="sub-district--unchecked",s;case"subLI":return s=document.createElement("li"),s.className="sub-district--list",s.innerText=i,s;default:console.log("Undefined")}},addList(){fetch("./data/district.json").then((t=>t.json())).then((i=>function(i){if(!t.isObject(i))return;const s=document.createDocumentFragment();for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)){const n=e.createEl("LI"),r=e.createEl("STRONG",t),a=e.createEl("EM"),c=e.createEl("UL"),o=i[t];n.append(r,a);for(let t=0;t<o.length;t++){const i=e.createEl("subLI",o[t]);c.append(i)}n.append(c),s.append(n)}document.getElementById("districtList").append(s)}(i)))}};class i{#canvas={canvasEl:null,ctx:null};#circle={radius:0,X:0,Y:0,dividedAngle:0};#arrow={width:0,X:0,Y:0};#time={passedTime:0,totalTime:0};#spin={spinnedAngle:0,totalSpin:0};#districts=[];#colors=["#fc5c65","#fd9644","#fed330","#26de81","#2bcbba","#45aaf2","#4b7bec","#a55eea"];constructor(e){if(!t.isElementNode(e)||"CANVAS"!==e.nodeName)throw"Error ! 잘못된 데이터 타입 입니다.";return i.instance?(console.log("생성된 객체가 이미 존재합니다."),i.instance):(this.#canvas.canvasEl=e,this.#canvas.ctx=this.#canvas.canvasEl.getContext("2d"),this.#circle.X=this.#canvas.canvasEl.width/2,this.#circle.Y=this.#canvas.canvasEl.height/2,this.#circle.radius=this.#canvas.canvasEl.width/2*.9,this.#arrow.X=this.#circle.X,this.#arrow.Y=this.#circle.Y-this.#circle.radius,this.#arrow.width=.1*this.#circle.radius,i.instance=this,this)}setSize(){this.#circle.X=this.#canvas.canvasEl.width/2,this.#circle.Y=this.#canvas.canvasEl.height/2,this.#circle.radius=.9*this.#circle.X,this.#arrow.X=this.#circle.X,this.#arrow.Y=this.#circle.Y-this.#circle.radius,this.#arrow.width=.1*this.#circle.radius}drawArrow(){const{ctx:t}=this.#canvas;t.beginPath(),t.fillStyle="#778ca3",t.moveTo(this.#arrow.X,this.#arrow.Y),t.lineTo(this.#arrow.X+this.#arrow.width,this.#arrow.Y-this.#arrow.width),t.lineTo(this.#arrow.X-this.#arrow.width,this.#arrow.Y-this.#arrow.width),t.fill()}convertToRadian(e){if(t.isNumber(e))return e*(Math.PI/180)}setAngle(){this.#circle.dividedAngle=360/this.#districts.length}setTime(){const t=10*Math.random()%3+2;this.#time.totalTime=60*t,this.#time.passedTime=0}setSpin(){const t=10*Math.random()%2+2;this.#spin.totalSpin=360*t}addDistrict(e){t.isString(e)&&(this.#districts.push(e),this.setAngle())}removeDistrict(e){if(!t.isString(e))return;const i=this.#districts.indexOf(e);this.#districts.splice(i,1),this.setAngle()}easingOut(e,i,s,n){if(t.isNumber(e)&&t.isNumber(i)&&t.isNumber(s)&&t.isNumber(n))return e/=n,s*(--e*e*e+1)+i}divideCircle(e){if(!t.isNumber(e))return;const{ctx:i}=this.#canvas,{X:s,Y:n,dividedAngle:r}=this.#circle;i.beginPath(),i.moveTo(s,n);const{spinnedAngle:a}=this.#spin,c=e*r+a,o=c+r;i.arc(s,n,this.#circle.radius,this.convertToRadian(c),this.convertToRadian(o)),i.strokeStyle="transparent",i.stroke(),i.fillStyle=this.#colors[e%this.#colors.length],i.fill()}addText(e){if(!t.isNumber(e))return;const{ctx:i}=this.#canvas;i.font="20px serif",i.fillStyle="black",i.save();const{dividedAngle:s,radius:n,X:r,Y:a}=this.#circle,{spinnedAngle:c}=this.#spin,o=s/2+e*s+c,l=.9*n;i.translate(r+Math.cos(this.convertToRadian(o))*l,a+Math.sin(this.convertToRadian(o))*l);const d=e*s,h=90+d/2+(d+s)/2+c;i.rotate(this.convertToRadian(h)),i.fillText(this.#districts[e],-i.measureText(this.#districts[e]).width/2,0),i.restore()}drawRoulette(){this.#canvas.ctx.clearRect(0,0,this.#canvas.canvasEl.width,this.#canvas.canvasEl.height),this.drawArrow();for(let t=0;t<this.#districts.length;t++)this.divideCircle(t),this.addText(t)}spinRoulette(){let{passedTime:t,totalTime:e}=this.#time;if(t<e){t=++this.#time.passedTime;let{totalSpin:i}=this.#spin;this.#spin.spinnedAngle=this.easingOut(t,0,i,e),this.drawRoulette(),window.requestAnimationFrame(this.spinRoulette.bind(this))}else this.stopRoulette()}stopRoulette(){const{spinnedAngle:t}=this.#spin,{dividedAngle:e}=this.#circle,i=t+90,s=Math.floor((360-i%360)/e);alert(this.#districts[s])}}e.setHTML(),e.addList();const s=document.getElementById("canvas");s.width=s.parentNode.offsetWidth,s.height=s.parentNode.offsetWidth;const n=new i(s);n.drawArrow(),window.addEventListener("resize",(()=>{s.width=s.parentNode.offsetWidth,s.height=s.parentNode.offsetWidth,n.setSize(),n.drawArrow(),n.drawRoulette()})),document.getElementById("districtList").addEventListener("click",(t=>{if("STRONG"===t.target.nodeName||"LI"===t.target.nodeName)if("STRONG"===t.target.nodeName){let e=t.target.nextSibling;for(;"UL"!==e.nodeName;e=e.nextSibling);t.target.classList.toggle("main-district--name--checked"),e.classList.toggle("sub-district--unchecked")}else if(0===t.target.children.length){let e=t.target.parentNode;for(;"EM"!==e.nodeName;e=e.previousSibling);t.target.classList.toggle("sub-district--list--checked"),t.target.classList.contains("sub-district--list--checked")?(n.addDistrict(t.target.innerText),n.drawRoulette(),e.innerText=""===e.innerText?"1":(parseInt(e.innerText)+1).toString()):(n.removeDistrict(t.target.innerText),n.drawRoulette(),e.innerText="1"===e.innerText?e.innerText="":(parseInt(e.innerText)-1).toString())}})),document.getElementById("start").addEventListener("click",(()=>{n.setTime(),n.setSpin(),n.spinRoulette()}))})();